---
title: "R Notebook"
output: html_notebook
---

```{r}
pacman::p_load(tidyverse, reshape2, janitor, ggmap, maptools, MAP)

ASYLUM_DK <- read.csv("data/ASYLUM_DK_ENGLISH.csv", header=F, comment.char="#")

#organizing columns and rows, tidying it all up
ASYLUM_DK <- ASYLUM_DK %>% select(-c(1)) 
ASYLUM_DK <- ASYLUM_DK[-1,-3,]
ASYLUM_DK <- ASYLUM_DK[-2,]

#making the first row to column names
ASYLUM_DK <- row_to_names(ASYLUM_DK, row_number = 1)

#chaning column 1 to "region"
names(ASYLUM_DK)[1] <- "region"

#removin columns with blank spaces
# ASYLUM_DK <- ASYLUM_DK[!(ASYLUM_DK$country ==""), ]

# #as some countries have "?" instead of æ/ø i'm replacing it with ae/oe
# ASYLUM_DK$country <- str_replace_all(string = as.character(ASYLUM_DK$country),pattern =  "�", replacement = "ae/oe")

```

This takes all columns and summarizes into on column per year
```{r}
lis<- c(2, seq(from =5, to =118, by=4))

for (i in lis) {
  print(i)
  if(i == 2){
  new_col <- 
    as.numeric(as.character(ASYLUM_DK[,i])) + 
    as.numeric(as.character(ASYLUM_DK[,i+1])) + 
    as.numeric(as.character(ASYLUM_DK[,i+2]))
    name <- str_extract(colnames(ASYLUM_DK[i]), "[0-9]*")
    colnames(ASYLUM_DK)[length(ASYLUM_DK)] <- name
  
  }
  else{
  ASYLUM_DK[,length(ASYLUM_DK)+1] <- 
    as.numeric(as.character(ASYLUM_DK[,i])) + 
    as.numeric(as.character(ASYLUM_DK[,i+1])) + 
    as.numeric(as.character(ASYLUM_DK[,i+2])) + 
    as.numeric(as.character(ASYLUM_DK[,i+3]))
  name <- str_extract(colnames(ASYLUM_DK[i]), "[0-9]*")
  colnames(ASYLUM_DK)[length(ASYLUM_DK)] <- name
  
  }
}
```


Selecting only summed years and making it long format
```{r}
summed_asylum_dk <- ASYLUM_DK %>% 
  select(1, 122:length(ASYLUM_DK)) %>% 
  gather(year, no_migrants, -region)

```

Overview of data
```{r}
summed_asylum_dk %>% 
  filter(no_migrants>0, region == "Afghanistan" | region == "Syria") %>% 
  ggplot(aes(
    x = as.numeric(year), 
    y = as.numeric(no_migrants),
    color = as.factor(region))) + 
  geom_line() +
  labs(x = "year", y = "number of migrants")

```

```{r anim}
summed_asylum_dk %>% mutate(year = as.numeric(year), no_migrants = as.numeric(no_migrants)) %>% 
  filter(no_migrants>0, region == "Afghanistan" | region == "Syria") %>% 
  ggplot(aes(
    x = year, 
    y = no_migrants,
    color = region)) + 
  geom_point()+#geom_line() +
  # labs(title = 'Year: {frame_time}') +
  transition_time(year)

```


Collecting coordinates for a world map
```{r}
write.csv(ASYLUM_DK$country, "DK_Countries.csv")

# countries_EN <- read_csv("data/Countries.csv", col_names = FALSE)
# countries_EN<- countries_EN[-c(1:6),]

# #removing stupid characters in a silly way
# countries_EN$X1<- str_remove_all(countries_EN$X1, "\\\\")
# countries_EN$X1<- str_remove_all(countries_EN$X1, "f0fs24 cf0")
# countries_EN$X1 <- str_remove_all(countries_EN$X1, "[}]")
# countries_EN$X1 <- trimws(countries_EN$X1)

world_info <- map_data("world")
coords <- world_info %>% select(
  long,
  lat,
  region
)

asylum_stat_map <- coords %>% left_join(summed_asylum_dk)



```



```{r}
pacman::p_load(lubridate,ggplot2, data.table, ggrepel, dplyr, tidyverse)
pacman::p_load(rworldmap)

newmap <- getMap(resolution = "low")
plot(newmap, xlim = c(-20, 59), ylim = c(35, 71), asp = 1)
points(asylum_stat_map$long, asylum_stat_map$lat, col = "red", cex = .6)
library(ggmap)
map <- get_map(location = 'Europe', zoom = 4)


#A) Download the main crime incident dataset

incidents = read.csv('https://raw.githubusercontent.com/lgellis/MiscTutorial/master/ggmap/i2Sample.csv', stringsAsFactors = FALSE)

#B) Download the extra dataset with the most dangerous Seattle cities as per:

# https://housely.com/dangerous-neighborhoods-seattle/

n <- read.csv('https://raw.githubusercontent.com/lgellis/MiscTutorial/master/ggmap/n.csv', stringsAsFactors = FALSE)

# Look at the data sets

dim(incidents)
col1 = "#011f4b"
col2 = "#6497b1"
col3 = "#b3cde0"
col4 = "#CC0000"

#add year to the incidents data frame
incidents$ymd <-mdy_hms(incidents$Event.Clearance.Date)
incidents$year <- year(incidents$ymd)

#Create a more manageable data frame with only 2017 and 2018 data
i2 <- incidents %>% 
  filter(year>=2017 & year<=2018)

#Only include complete cases
i2[complete.cases(i2), ]

#create a display label to the n data frame (dangerous neighbourhoods)
n$label <-paste(n$Rank, n$Location, sep="-")

##API

if(!requireNamespace("devtools")) install.packages("devtools")
devtools::install_github("dkahle/ggmap", ref = "tidyup", force=TRUE)
pacman::p_load(ggmap)
ggmap::register_google(key = "AIzaSyAwBtv7qI5mWf2YDxmp8Ozk0sZ6S6iLqOA")


##1) Create a map with all of the crime locations plotted.
p <- ggmap(get_googlemap(center = c(lon = -122.335167, lat = 47.608013),
                    zoom = 11, scale = 2,
                    maptype ='terrain',
                    color = 'color'))
p + geom_point(aes(x = Longitude, y = Latitude,  colour = Initial.Type.Group), data = i2, size = 0.5) + 
  theme(legend.position="bottom")


```


```{r}
asylum_stat_map$destination <- "Denmark"
```

